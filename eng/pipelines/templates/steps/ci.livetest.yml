parameters:
  - name: LiveTestSamples
    type: object
    default: []
  - name: OSName
    type: string
    default: ''

steps:
  - template: /eng/pipelines/templates/steps/vcpkg.yml

  - template: /eng/pipelines/templates/steps/cmake-build.yml
    parameters:
      BuildArgs: $(build.args)

  - template: /eng/common/TestResources/deploy-test-resources.yml
    parameters:
      ServiceDirectory: 'samples'

  # Run live tests
  - ${{ each sample in parameters.LiveTestSamples }}:
    - ${{ if eq(parameters.OSName, 'windows') }}:
      - script: ${{ sample.WindowsPath }}
        displayName: Live Test ${{ sample.Name }} (Windows)
        ${{ if ne(sample.RunCondition, '') }}:
          condition: ${{ sample.RunCondition }}
    - ${{ else }}:
      - script: ${{ sample.NonWindowsPath }}
        displayName: Live Test ${{ sample.Name }} (Non-Windows)
        ${{ if ne(sample.RunCondition, '') }}:
          condition: ${{ sample.RunCondition }}

  - template: /eng/common/TestResources/remove-test-resources.yml
    parameters:
      ServiceDirectory: 'samples'
